<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Typelevel.scala | Validated Configurations with Ciris</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Let the Scala compiler work for you. We provide type classes, instances, conversions, testing, supplements to the standard library, and much more.">


    <link rel="mask-icon" href="/img/favicon-safari.svg" color="#F51C2B">
    <link href="/img/favicon.png" rel="icon" type="image/x-icon">
    <link rel="alternate" href="/blog/feed.rss" title="RSS feed" type="application/rss+xml">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,400italic,700' rel='stylesheet' type='text/css'>

    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/app.js"></script>
  </head>
  <body class="no-js ">
    <div class="header">
      <div class="wrapper">
        <a href="/">
          <div class="header__logo">
            Typelevel.scala
          </div>
        </a>
        <a href="#" class="header__menu">
          Menu
        </a>
        <ul class="navigation" role="navigation">
          <li >
            <a href="/projects/">Projects</a>
          </li>
          <li >
            <a href="/events/">Events</a>
          </li>
          <li  class="active" >
            <a href="/blog/">Blog</a>
          </li>
          <li >
            <a href="/about.html">About</a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="wrapper">
      <div class="content post js-fade-in">
  <h2>Validated Configurations with Ciris</h2>

  <p>The need for configuration arises in almost every application, as we want to be able to run in different environments – for example, local, testing, and production environments. Configurations are also used as a way to keep secrets, like passwords and keys, out of source code and version control. By having configurations as untyped structured data in files, we can change and override settings without having to recompile our software.</p>

<p>In this blog post, we’ll take a look at configurations with configuration files, to see how we can make the loading process less error-prone, while overcoming obstacles with boilerplate, testing, and validation. We’ll also identify when it’s suitable to use Scala as a configuration language for improved compile-time safety, convenience, and flexibility; and more specifically, how <a href="https://cir.is">Ciris</a> helps out.</p>

<h3 id="configuration-files">Configuration Files</h3>
<p>Traditionally, configuration files, and libraries like <a href="https://github.com/typesafehub/config">Typesafe Config</a>, have been used to load configurations. This involves writing your configuration file, declaring values and how they’re loaded, and then writing very similar Scala code for loading that configuration. That kind of boilerplate code typically looks something along the lines of the following example.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.typesafe.config.</span><span class="o">{</span><span class="nc">Config</span><span class="o">,</span> <span class="nc">ConfigFactory</span><span class="o">}</span>

<span class="c1">// The settings class, wrapping Typesafe Config
</span><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Settings</span><span class="o">(</span><span class="n">config</span><span class="k">:</span> <span class="kt">Config</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">object</span> <span class="nc">http</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">apiKey</span> <span class="k">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="o">(</span><span class="s">"http.api-key"</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="o">(</span><span class="s">"http.timeout-seconds"</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">port</span> <span class="k">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="o">(</span><span class="s">"http.port"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// The configuration file, here represented in code
</span><span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
  <span class="nc">ConfigFactory</span><span class="o">.</span><span class="n">parseString</span><span class="o">(</span>
    <span class="s">"""
      |http {
      |  api-key = ${?API_KEY}
      |  timeout-seconds = 10
      |  port = 989
      |}
    """</span><span class="o">.</span><span class="n">stripMargin</span>
  <span class="o">).</span><span class="n">resolve</span><span class="o">()</span>

<span class="k">val</span> <span class="n">settings</span> <span class="k">=</span> <span class="nc">Settings</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span><span class="o">(</span><span class="n">settings</span><span class="o">)</span>
<span class="c1">// Settings(Config(SimpleConfigObject({"http":{"port":989,"timeout-seconds":10}})))
</span></code></pre></div></div>

<p>This is a tedious, error-prone process that rarely sees any testing efforts. <a href="https://github.com/pureconfig/pureconfig">PureConfig</a> (and other libraries, like <a href="https://github.com/47deg/case-classy">Case Classy</a>) were created to remove that boilerplate. Using macros and conventions, they inspect your configuration model (nested case classes) and generate the necessary configuration loading code. This eliminates a lot of errors typically associated with configuration loading. Following is an example of how you can load that very same configuration with PureConfig.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HttpSettings</span><span class="o">(</span>
  <span class="n">apiKey</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">timeoutSeconds</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
  <span class="n">port</span><span class="k">:</span> <span class="kt">Int</span>
<span class="o">)</span>

<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Settings</span><span class="o">(</span><span class="n">http</span><span class="k">:</span> <span class="kt">HttpSettings</span><span class="o">)</span>

<span class="k">val</span> <span class="n">settings</span> <span class="k">=</span> <span class="n">pureconfig</span><span class="o">.</span><span class="n">loadConfig</span><span class="o">[</span><span class="kt">Settings</span><span class="o">](</span><span class="n">config</span><span class="o">)</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span><span class="o">(</span><span class="n">settings</span><span class="o">)</span>
<span class="c1">// Left(ConfigReaderFailures(KeyNotFound("http.api-key", None, Set()), List()))
</span></code></pre></div></div>

<h3 id="encoding-validation">Encoding Validation</h3>
<p>In both previous examples, we do not check whether our configurations are valid to use with our application. In the case of Typesafe Config, we hit a runtime exception if the key is missing or if the type conversion fails, and in PureConfig’s case, we will instead get a <code class="highlighter-rouge">ConfigReaderFailures</code>. But in neither case do we care what values are being loaded, as long as they can be converted to the appropriate types. For example, we might require a key of certain length and that it only contains certain characters, the timeout needs to be positive, and the port must be a non-system port number (value in the inclusive range between 1024 and 65535).</p>

<p>You could write an additional validation step to ensure the configuration is valid after it has been loaded – which can be tedious to write and requires testing. One could also argue that the types of the configuration values are too permissive: why use <code class="highlighter-rouge">String</code> for the key if you do not accept all <code class="highlighter-rouge">String</code> values? And why use an <code class="highlighter-rouge">Int</code> for timeout and port, if you only allow a limited subset of values?</p>

<p>We could write these custom types ourselves, including the validation logic, and tell PureConfig how to load them – which would be tedious to write for many types and would require testing. Another alternative is to use <a href="https://github.com/fthomas/refined">refined</a>, which allows you to do type-level refinements (apply predicates) to types. I found this approach so useful that I wrote a small integration between PureConfig and refined at the end of last year (see <a href="https://blog.vlovgr.se/posts/2016-12-24-refined-configuration.html">blog post</a>), so that PureConfig can now load refined’s types.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">eu.timepit.refined.api.Refined</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.numeric.Interval</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.pureconfig._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.string.MatchesRegex</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.types.numeric.PosInt</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.W</span>

<span class="k">type</span> <span class="kt">ApiKey</span> <span class="o">=</span> <span class="nc">String</span> <span class="nc">Refined</span> <span class="nc">MatchesRegex</span><span class="o">[</span><span class="kt">W.`</span><span class="err">"</span><span class="o">[</span><span class="kt">a-zA-Z0-</span><span class="err">9</span><span class="o">]{</span><span class="err">25</span>,<span class="err">40</span><span class="o">}</span><span class="err">"</span><span class="kt">`.T</span><span class="o">]</span>

<span class="k">type</span> <span class="kt">NonSystemPort</span> <span class="o">=</span> <span class="nc">Int</span> <span class="nc">Refined</span> <span class="nc">Interval</span><span class="o">.</span><span class="nc">Closed</span><span class="o">[</span><span class="kt">W.`</span><span class="err">1024</span><span class="kt">`.T</span>, <span class="kt">W.`</span><span class="err">65535</span><span class="kt">`.T</span><span class="o">]</span>

<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HttpSettings</span><span class="o">(</span>
  <span class="n">apiKey</span><span class="k">:</span> <span class="kt">ApiKey</span><span class="o">,</span>
  <span class="n">timeoutSeconds</span><span class="k">:</span> <span class="kt">PosInt</span><span class="o">,</span>
  <span class="n">port</span><span class="k">:</span> <span class="kt">NonSystemPort</span>
<span class="o">)</span>

<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Settings</span><span class="o">(</span><span class="n">http</span><span class="k">:</span> <span class="kt">HttpSettings</span><span class="o">)</span>

<span class="k">val</span> <span class="n">settings</span> <span class="k">=</span> <span class="n">pureconfig</span><span class="o">.</span><span class="n">loadConfig</span><span class="o">[</span><span class="kt">Settings</span><span class="o">](</span><span class="n">config</span><span class="o">)</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span><span class="o">(</span><span class="n">settings</span><span class="o">)</span>
<span class="c1">// Left(
//   ConfigReaderFailures(
//     KeyNotFound("http.api-key", None, Set()),
//     List(
//       CannotConvert(
//         "989",
//         "eu.timepit.refined.api.Refined[Int,eu.timepit.refined.boolean.And[eu.timepit.refined.boolean.Not[eu.timepit.refined.numeric.Less[Int(1024)]],eu.timepit.refined.boolean.Not[eu.timepit.refined.numeric.Greater[Int(65535)]]]]",
//         "Left predicate of (!(989 &lt; 1024) &amp;&amp; !(989 &gt; 65535)) failed: Predicate (989 &lt; 1024) did not fail.",
//         None,
//         "http.port"
//       )
//     )
//   )
// )
</span></code></pre></div></div>

<p>As you can see in the example above, refined already contains type aliases for many common refinement types, like <code class="highlighter-rouge">PosInt</code> (for <code class="highlighter-rouge">Int</code> values greater than zero). You can also easily define your own predicates, like the one for the key and port. The <code class="highlighter-rouge">W</code> here is a shorthand for <a href="https://github.com/milessabin/shapeless">shapeless</a>’ <code class="highlighter-rouge">Witness</code>: a way to encode literal-based singleton types (essentially, values on the type-level). If you’re using <a href="https://typelevel.org/scala/">Typelevel Scala</a> with the <code class="highlighter-rouge">-Yliteral-types</code> flag, you can write values directly in the type declaration, without having to use <code class="highlighter-rouge">Witness</code>.</p>

<p>If you’re not convinced configurations need to be validated, I can recommend reading the paper <a href="https://www.usenix.org/system/files/conference/osdi16/osdi16-xu.pdf">Early Detection of Configuration Errors to Reduce Failure Damage</a>, and to read through the slides of Leif Wickland’s (one of the authors behind PureConfig) recent presentation <a href="http://leifwickland.github.io/presentations/configBomb/">Defusing the Configuration Time Bomb</a> on the subject.</p>

<p>In many ways, think of configurations as user input – would you happily accept any values provided to your application from its users? Probably not: you would validate the input, and sanitize it if possible. Think about configurations in the same way, except that the user here might happen to be a developer of the application. The key here, as discussed in the paper linked above, is to check that your configuration is valid as soon as possible, ideally at compile-time, or as soon as the application starts. We want to avoid situations where we’re running the application and suddenly discover that configuration values are invalid or cannot be loaded – or worse, continue running with an invalid configuration, not to discover issues until much later on.</p>

<h3 id="improving-compile-time-safety">Improving Compile-time Safety</h3>
<p>We’ve now got a way to encode validation in the types of our configurations, and a boilerplate-free way of loading values of those types from configuration files – is there still room for improvement? To answer that question, we first need to ask why we are using configuration files in the first place.</p>

<p>Whether you thought about it or not, the main reason for using configuration files is so that we can change settings without having to recompile the software. In my experience, most developers default to using configuration files, and almost always change values by pushing commits to a version control repository. This is followed by a new release of the software, either manually or via a <a href="https://www.agilealliance.org/glossary/continuous-integration">continuous integration</a> system. In scenarios like this, and in general when it’s easy to change and release software (particularly when employing <a href="https://www.agilealliance.org/glossary/continuous-deployment/">continuous deployment</a> practices), configuration files are not used for the benefit of being able to change values without recompile.</p>

<p>In such cases, why are we not writing the configurations directly in source code? Christopher Vogt has written an excellent <a href="https://medium.com/@cvogt/scala-as-a-configuration-language-f075b058a660">blog post</a> (and given a <a href="https://www.youtube.com/watch?v=ox4IhIL6ojg">presentation</a>) on the subject. The tricky part here is managing values which need to be dynamic in the environment (like the port to bind) and are secret (like passwords and keys). Depending on your requirements and preferences, you more or less have two alternatives.</p>

<ul>
  <li>
    <p>If you know which environments your application will run in, and what the configuration values will be in those environments, you can just include the configurations in your application code (if it has no secrets), or store, compile, and bundle the configuration separately. If you have a requirement that secrets shouldn’t touch persistent storage, this might not be a feasible alternative. You might also appreciate the fact that all code relating to your application is in the same version control repository and gets compiled together, in which case this approach might not be suitable.</p>
  </li>
  <li>
    <p>Alternatively, you can include the configuration in your application, but load secrets and values which need to be dynamic from the environment during runtime. This is necessary when configuration values cannot be determined beforehand – because you do not know what environment your application will run in, or if you use a vault (like <a href="https://github.com/fugue/credstash">credstash</a>, for example) or a configuration service (like <a href="https://zookeeper.apache.org">ZooKeeper</a>, for example) – or if you prefer having your configuration together with your application code and in the same version control repository.</p>
  </li>
</ul>

<p>In this post, we’ll only focus on the latter case. While it’s possible to not use any libraries in the latter case, loading values from the environment typically means dealing with: different environments and configuration sources, type conversions, error handling, and validation. This is where <a href="https://cir.is">Ciris</a> comes in: a small library, dependency-free at its core, helping you to deal with all of that more easily.</p>

<h3 id="introducing-ciris">Introducing Ciris</h3>
<p>Imagine for the moment that no part of your configuration is secret and that your application only ever runs in one environment. You can then just write your configuration in code.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">eu.timepit.refined.auto._</span>

<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Config</span><span class="o">(</span>
  <span class="n">apiKey</span><span class="k">:</span> <span class="kt">ApiKey</span><span class="o">,</span>
  <span class="n">timeoutSeconds</span><span class="k">:</span> <span class="kt">PosInt</span><span class="o">,</span>
  <span class="n">port</span><span class="k">:</span> <span class="kt">NonSystemPort</span>
<span class="o">)</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
  <span class="nc">Config</span><span class="o">(</span>
    <span class="n">apiKey</span> <span class="k">=</span> <span class="s">"RacrqvWjuu4KVmnTG9b6xyZMTP7jnX"</span><span class="o">,</span>
    <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
    <span class="n">port</span> <span class="k">=</span> <span class="mi">4000</span>
  <span class="o">)</span>
</code></pre></div></div>

<p>You then realize that it’s a bad idea to put the key in the source code, because source code can easily get into the wrong hands. You decide that you’ll instead read an environment variable for the key. Since you want to make sure that your configuration is valid, you have used refinement types, so you’ll have to make sure to check that the key conforms to the predicate. You would also welcome a helpful error message if the key is missing or invalid. This sounds like more work than it should be, so let’s see how <a href="https://cir.is">Ciris</a> can help us.</p>

<p>Ciris method for loading configurations is <code class="highlighter-rouge">loadConfig</code> and it works in two steps: first define what to load, and then how to load the configuration. For reading a key from an environment variable, you can use <code class="highlighter-rouge">env[ApiKey]("API_KEY")</code> which reads the environment variable <code class="highlighter-rouge">API_KEY</code> as an <code class="highlighter-rouge">ApiKey</code>. Ciris has a refined integration in a separate module, so you just need to add an appropriate import. Loading the configuration is then just a function accepting the loaded values as arguments.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ciris._</span>
<span class="k">import</span> <span class="nn">ciris.refined._</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
  <span class="n">loadConfig</span><span class="o">(</span>
    <span class="n">env</span><span class="o">[</span><span class="kt">ApiKey</span><span class="o">](</span><span class="s">"API_KEY"</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">{</span> <span class="n">apiKey</span> <span class="k">=&gt;</span>
    <span class="nc">Config</span><span class="o">(</span>
      <span class="n">apiKey</span> <span class="k">=</span> <span class="n">apiKey</span><span class="o">,</span>
      <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
      <span class="n">port</span> <span class="k">=</span> <span class="mi">4000</span>
    <span class="o">)</span>
  <span class="o">}</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
<span class="c1">// Left(ConfigErrors(MissingKey(API_KEY, Environment)))
</span></code></pre></div></div>

<p>Ciris deals with type conversions, error handling, and error accumulation, so you can focus on your configuration. The <code class="highlighter-rouge">loadConfig</code> method returns an <code class="highlighter-rouge">Either[ConfigErrors, T]</code> instance back, where <code class="highlighter-rouge">T</code> is the result of your configuration loading function. You can retrieve the accumulated error messages by using <code class="highlighter-rouge">messages</code> on <code class="highlighter-rouge">ConfigErrors</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span> <span class="o">{</span> <span class="n">config</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">messages</span><span class="o">)</span> <span class="o">}</span>
<span class="c1">// Left(Vector("Missing environment variable [API_KEY]"))
</span></code></pre></div></div>

<p>If we decided that the port needs to be dynamic as well, we can simply make that change. In the example below, we are using <code class="highlighter-rouge">prop</code> to read the <code class="highlighter-rouge">http.port</code> system property for the port to use. As you can see, you are free to mix configuration sources as you please. While we are reading environment variables and system properties in these examples, you could just as well use sources for some configuration services or vaults.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
  <span class="n">loadConfig</span><span class="o">(</span>
    <span class="n">env</span><span class="o">[</span><span class="kt">ApiKey</span><span class="o">](</span><span class="s">"API_KEY"</span><span class="o">),</span>
    <span class="n">prop</span><span class="o">[</span><span class="kt">NonSystemPort</span><span class="o">](</span><span class="s">"http.port"</span><span class="o">)</span>
  <span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">apiKey</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nc">Config</span><span class="o">(</span>
      <span class="n">apiKey</span> <span class="k">=</span> <span class="n">apiKey</span><span class="o">,</span>
      <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
      <span class="n">port</span> <span class="k">=</span> <span class="n">port</span>
    <span class="o">)</span>
  <span class="o">}</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span> <span class="o">{</span> <span class="n">config</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">messages</span><span class="o">)</span> <span class="o">}</span>
<span class="c1">// Left(
//   Vector(
//     "Missing environment variable [API_KEY]",
//     "Missing system property [http.port]"
//   )
// )
</span></code></pre></div></div>

<p>You might recognize the similarities between <code class="highlighter-rouge">loadConfig</code> and <code class="highlighter-rouge">ValidatedNel</code> with an <code class="highlighter-rouge">Apply</code> instance from <a href="https://typelevel.org/cats/">Cats</a>. That’s because it’s more or less how <code class="highlighter-rouge">loadConfig</code> works behind the scenes, except Ciris has its own custom implementation in order to be dependency-free in the core module.</p>

<h4 id="multiple-environments">Multiple Environments</h4>
<p>We still have to deal with multiple environments in our configuration, assuming there are differences between configurations, or how they are loaded, in the different environments. There are several ways you can do this with Ciris – one way is to define an enumeration with <a href="https://github.com/lloydmeta/enumeratum">enumeratum</a> and load values of that enumeration. Let’s say we want to use a default configuration when running the application locally, but want to keep the key and port dynamic in the other environments (testing and production). We start by defining an enumeration of the different environments.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">_root_.enumeratum._</span>

<span class="k">object</span> <span class="nc">environments</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">AppEnvironment</span> <span class="k">extends</span> <span class="nc">EnumEntry</span>
  <span class="k">object</span> <span class="nc">AppEnvironment</span> <span class="k">extends</span> <span class="nc">Enum</span><span class="o">[</span><span class="kt">AppEnvironment</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">case</span> <span class="k">object</span> <span class="nc">Local</span> <span class="k">extends</span> <span class="nc">AppEnvironment</span>
    <span class="k">case</span> <span class="k">object</span> <span class="nc">Testing</span> <span class="k">extends</span> <span class="nc">AppEnvironment</span>
    <span class="k">case</span> <span class="k">object</span> <span class="nc">Production</span> <span class="k">extends</span> <span class="nc">AppEnvironment</span>

    <span class="k">val</span> <span class="n">values</span> <span class="k">=</span> <span class="n">findValues</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We can use the <code class="highlighter-rouge">withValue</code> method to define a requirement on a configuration value in order to be able to load our configuration. It works just like <code class="highlighter-rouge">loadConfig</code>, except it wraps your <code class="highlighter-rouge">loadConfig</code> statements (think of it as <code class="highlighter-rouge">flatMap</code>, while <code class="highlighter-rouge">loadConfig</code> is <code class="highlighter-rouge">map</code>). If no environment was specified in the environment variable <code class="highlighter-rouge">APP_ENV</code> or if it was set to <code class="highlighter-rouge">Local</code>, we will use a default configuration. We’ll load the configuration just like before for any other valid environments (testing and production).</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">environments._</span>
<span class="k">import</span> <span class="nn">ciris.enumeratum._</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
  <span class="n">withValue</span><span class="o">(</span><span class="n">env</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">AppEnvironment</span><span class="o">]](</span><span class="s">"APP_ENV"</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">AppEnvironment</span><span class="o">.</span><span class="nc">Local</span><span class="o">)</span> <span class="o">|</span> <span class="nc">None</span> <span class="k">=&gt;</span>
      <span class="n">loadConfig</span> <span class="o">{</span>
        <span class="nc">Config</span><span class="o">(</span>
          <span class="n">apiKey</span> <span class="k">=</span> <span class="s">"RacrqvWjuu4KVmnTG9b6xyZMTP7jnX"</span><span class="o">,</span>
          <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
          <span class="n">port</span> <span class="k">=</span> <span class="mi">4000</span>
        <span class="o">)</span>
      <span class="o">}</span>

    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span>
      <span class="n">loadConfig</span><span class="o">(</span>
        <span class="n">env</span><span class="o">[</span><span class="kt">ApiKey</span><span class="o">](</span><span class="s">"API_KEY"</span><span class="o">),</span>
        <span class="n">prop</span><span class="o">[</span><span class="kt">NonSystemPort</span><span class="o">](</span><span class="s">"http.port"</span><span class="o">)</span>
      <span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">apiKey</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="nc">Config</span><span class="o">(</span>
          <span class="n">apiKey</span> <span class="k">=</span> <span class="n">apiKey</span><span class="o">,</span>
          <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
          <span class="n">port</span> <span class="k">=</span> <span class="n">port</span>
        <span class="o">)</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
<span class="c1">// Right(Config(RacrqvWjuu4KVmnTG9b6xyZMTP7jnX, 10, 4000))
</span></code></pre></div></div>

<p>An alternative to the above is to have multiple entrypoints (<code class="highlighter-rouge">main</code> methods) in your application, each running the application with different configuration loading code (or using a default configuration) for the respective environment. Depending on how packaging and running of your application looks like across different environments, this may or may not be a suitable solution. Note that it’s very much possible to mix these approaches, and you should strive to find what works best in your case.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Runs the application with the provided configuration
</span><span class="k">def</span> <span class="n">runApplication</span><span class="o">(</span><span class="n">config</span><span class="k">:</span> <span class="kt">Config</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="cm">/* omitted */</span> <span class="o">}</span>

<span class="k">object</span> <span class="nc">Local</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
    <span class="n">runApplication</span> <span class="o">{</span>
      <span class="nc">Config</span><span class="o">(</span>
        <span class="n">apiKey</span> <span class="k">=</span> <span class="s">"RacrqvWjuu4KVmnTG9b6xyZMTP7jnX"</span><span class="o">,</span>
        <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
        <span class="n">port</span> <span class="k">=</span> <span class="mi">4000</span>
      <span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">TestingOrProduction</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
    <span class="n">runApplication</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
        <span class="n">loadConfig</span><span class="o">(</span>
          <span class="n">env</span><span class="o">[</span><span class="kt">ApiKey</span><span class="o">](</span><span class="s">"API_KEY"</span><span class="o">),</span>
          <span class="n">prop</span><span class="o">[</span><span class="kt">NonSystemPort</span><span class="o">](</span><span class="s">"http.port"</span><span class="o">)</span>
        <span class="o">)</span> <span class="o">{</span> <span class="o">(</span><span class="n">apiKey</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="nc">Config</span><span class="o">(</span>
            <span class="n">apiKey</span> <span class="k">=</span> <span class="n">apiKey</span><span class="o">,</span>
            <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
            <span class="n">port</span> <span class="k">=</span> <span class="n">port</span>
          <span class="o">)</span>
        <span class="o">}</span>

      <span class="n">config</span><span class="o">.</span><span class="n">fold</span><span class="o">(</span>
        <span class="n">errors</span> <span class="k">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="n">s</span><span class="s">"Unable to load configuration: ${errors.messages}"</span><span class="o">),</span>
        <span class="n">identity</span>
      <span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="testing-configurations">Testing Configurations</h4>
<p>Writing your configurations in Scala means you have the flexibility to work with them as you want. You’re no longer limited to what can be done with configuration files. Sharing configurations between your application and tests is also very straightforward – simply make the configuration loading function (and the default configuration) available for the tests.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This can now be accessed from the tests
</span><span class="k">val</span> <span class="n">defaultConfig</span> <span class="k">=</span>
  <span class="nc">Config</span><span class="o">(</span>
    <span class="n">apiKey</span> <span class="k">=</span> <span class="s">"RacrqvWjuu4KVmnTG9b6xyZMTP7jnX"</span><span class="o">,</span>
    <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
    <span class="n">port</span> <span class="k">=</span> <span class="mi">4000</span>
  <span class="o">)</span>

<span class="c1">// This can now be accessed from the tests
</span><span class="k">val</span> <span class="n">configWith</span> <span class="k">=</span>
  <span class="o">(</span><span class="n">apiKey</span><span class="k">:</span> <span class="kt">ApiKey</span><span class="o">,</span> <span class="n">port</span><span class="k">:</span> <span class="kt">NonSystemPort</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nc">Config</span><span class="o">(</span>
      <span class="n">apiKey</span> <span class="k">=</span> <span class="n">apiKey</span><span class="o">,</span>
      <span class="n">timeoutSeconds</span> <span class="k">=</span> <span class="mi">10</span><span class="o">,</span>
      <span class="n">port</span> <span class="k">=</span> <span class="n">port</span>
    <span class="o">)</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span>
  <span class="n">withValue</span><span class="o">(</span><span class="n">env</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">AppEnvironment</span><span class="o">]](</span><span class="s">"APP_ENV"</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">AppEnvironment</span><span class="o">.</span><span class="nc">Local</span><span class="o">)</span> <span class="o">|</span> <span class="nc">None</span> <span class="k">=&gt;</span>
      <span class="n">loadConfig</span><span class="o">(</span><span class="n">defaultConfig</span><span class="o">)</span>
    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span>
      <span class="n">loadConfig</span><span class="o">(</span>
        <span class="n">env</span><span class="o">[</span><span class="kt">ApiKey</span><span class="o">](</span><span class="s">"API_KEY"</span><span class="o">),</span>
        <span class="n">prop</span><span class="o">[</span><span class="kt">NonSystemPort</span><span class="o">](</span><span class="s">"http.port"</span><span class="o">)</span>
      <span class="o">)(</span><span class="n">configWith</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>If you really want to unit test the configuration loading as well, you can do so with minor rewrites. Currently, we depend on some fixed configuration sources for environment variables and system properties (technically, system properties are mutable), but if we instead pass sources (<code class="highlighter-rouge">ConfigSource</code>s) as arguments, we can read values from those sources using the <code class="highlighter-rouge">read</code> method.</p>

<p>The <code class="highlighter-rouge">read</code> method normally looks for an implicit <code class="highlighter-rouge">ConfigSource</code> to read from, which would have been perfect if we only used a single source. But since we have multiple sources here, we instead use <code class="highlighter-rouge">read</code> to redefine <code class="highlighter-rouge">env</code> and <code class="highlighter-rouge">prop</code> to read from the provided sources. <code class="highlighter-rouge">ConfigReader[T]</code> captures the ability to convert from <code class="highlighter-rouge">String</code> to <code class="highlighter-rouge">T</code>, where the <code class="highlighter-rouge">String</code> value has been read from a <code class="highlighter-rouge">ConfigSource</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">config</span><span class="o">(</span>
  <span class="n">envs</span><span class="k">:</span> <span class="kt">ConfigSource</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span>
  <span class="n">props</span><span class="k">:</span> <span class="kt">ConfigSource</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
<span class="o">)</span><span class="k">:</span> <span class="kt">Either</span><span class="o">[</span><span class="kt">ConfigErrors</span>, <span class="kt">Config</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="c1">// Custom env which reads from envs
</span>  <span class="k">def</span> <span class="n">env</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">ConfigReader</span><span class="o">](</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span>
    <span class="n">read</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">key</span><span class="o">)(</span><span class="n">envs</span><span class="o">,</span> <span class="nc">ConfigReader</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span>

  <span class="c1">// Custom prop which reads from props
</span>  <span class="k">def</span> <span class="n">prop</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">ConfigReader</span><span class="o">](</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span>
    <span class="n">read</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">key</span><span class="o">)(</span><span class="n">props</span><span class="o">,</span> <span class="nc">ConfigReader</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span>

  <span class="n">withValue</span><span class="o">(</span><span class="n">env</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">AppEnvironment</span><span class="o">]](</span><span class="s">"APP_ENV"</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">AppEnvironment</span><span class="o">.</span><span class="nc">Local</span><span class="o">)</span> <span class="o">|</span> <span class="nc">None</span> <span class="k">=&gt;</span>
      <span class="n">loadConfig</span><span class="o">(</span><span class="n">defaultConfig</span><span class="o">)</span>
    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span>
      <span class="n">loadConfig</span><span class="o">(</span>
        <span class="n">env</span><span class="o">[</span><span class="kt">ApiKey</span><span class="o">](</span><span class="s">"API_KEY"</span><span class="o">),</span>
        <span class="n">prop</span><span class="o">[</span><span class="kt">NonSystemPort</span><span class="o">](</span><span class="s">"http.port"</span><span class="o">)</span>
      <span class="o">)(</span><span class="n">configWith</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We’ll then define a couple of helper methods for creating <code class="highlighter-rouge">ConfigSource</code>s from key-value pairs. The <code class="highlighter-rouge">ConfigSource</code> type parameter is the type of keys the source can read, which is <code class="highlighter-rouge">String</code> for both environment variables and system properties. The <code class="highlighter-rouge">ConfigKeyType</code> is basically the name of the key that can be read, for example <code class="highlighter-rouge">environment variable</code>. Below we’re using predefined instances in the <code class="highlighter-rouge">ConfigKeyType</code> companion object.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">envs</span><span class="o">(</span><span class="n">entries</span><span class="k">:</span> <span class="o">(</span><span class="kt">String</span><span class="o">,</span> <span class="kt">String</span><span class="o">)*)</span><span class="k">:</span> <span class="kt">ConfigSource</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">ConfigSource</span><span class="o">.</span><span class="n">fromMap</span><span class="o">(</span><span class="nc">ConfigKeyType</span><span class="o">.</span><span class="nc">Environment</span><span class="o">)(</span><span class="n">entries</span><span class="o">.</span><span class="n">toMap</span><span class="o">)</span>

<span class="k">def</span> <span class="n">props</span><span class="o">(</span><span class="n">entries</span><span class="k">:</span> <span class="o">(</span><span class="kt">String</span><span class="o">,</span> <span class="kt">String</span><span class="o">)*)</span><span class="k">:</span> <span class="kt">ConfigSource</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">ConfigSource</span><span class="o">.</span><span class="n">fromMap</span><span class="o">(</span><span class="nc">ConfigKeyType</span><span class="o">.</span><span class="nc">Property</span><span class="o">)(</span><span class="n">entries</span><span class="o">.</span><span class="n">toMap</span><span class="o">)</span>
</code></pre></div></div>

<p>We can test our <code class="highlighter-rouge">config</code> method using different combinations of environment variables and system properties. Note that <code class="highlighter-rouge">envs</code> and <code class="highlighter-rouge">props</code> have the same type, so if you want to avoid using them interchangeably, you can define custom wrapper types for them. We’ll leave that out here for sake of simplicity. I’ve found that it’s not very common to read values from more than one <code class="highlighter-rouge">ConfigSource</code>, but as it’s definitely possible, it can be worth making sure you do not mix them up.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span> <span class="o">{</span> <span class="n">config</span><span class="o">(</span><span class="n">envs</span><span class="o">(),</span> <span class="n">props</span><span class="o">())</span> <span class="o">}</span>
<span class="c1">// Right(Config(RacrqvWjuu4KVmnTG9b6xyZMTP7jnX, 10, 4000))
</span>
<span class="n">show</span> <span class="o">{</span>
  <span class="n">config</span><span class="o">(</span>
    <span class="n">envs</span><span class="o">(</span><span class="s">"APP_ENV"</span> <span class="o">-&gt;</span> <span class="s">"Local"</span><span class="o">),</span>
    <span class="n">props</span><span class="o">()</span>
  <span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Right(Config(RacrqvWjuu4KVmnTG9b6xyZMTP7jnX, 10, 4000))
</span>
<span class="n">show</span> <span class="o">{</span>
  <span class="n">config</span><span class="o">(</span>
    <span class="n">envs</span><span class="o">(</span><span class="s">"APP_ENV"</span> <span class="o">-&gt;</span> <span class="s">"QA"</span><span class="o">),</span>
    <span class="n">props</span><span class="o">()</span>
  <span class="o">).</span><span class="n">left</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">messages</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Left(
//   Vector(
//     "Environment variable [APP_ENV] with value [QA] cannot be converted to type [$line34.$read$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$environments$AppEnvironment]"
//   )
// )
</span>
<span class="n">show</span> <span class="o">{</span>
  <span class="n">config</span><span class="o">(</span>
    <span class="n">envs</span><span class="o">(</span><span class="s">"APP_ENV"</span> <span class="o">-&gt;</span> <span class="s">"Production"</span><span class="o">),</span>
    <span class="n">props</span><span class="o">()</span>
  <span class="o">).</span><span class="n">left</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">messages</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Left(
//   Vector(
//     "Missing environment variable [API_KEY]",
//     "Missing system property [http.port]"
//   )
// )
</span>
<span class="n">show</span> <span class="o">{</span>
  <span class="n">config</span><span class="o">(</span>
    <span class="n">envs</span><span class="o">(</span>
      <span class="s">"APP_ENV"</span> <span class="o">-&gt;</span> <span class="s">"Production"</span><span class="o">,</span>
      <span class="s">"API_KEY"</span> <span class="o">-&gt;</span> <span class="s">"changeme"</span>
    <span class="o">),</span>
    <span class="n">props</span><span class="o">()</span>
  <span class="o">).</span><span class="n">left</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">messages</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Left(
//   Vector(
//     "Environment variable [API_KEY] with value [changeme] cannot be converted to type [eu.timepit.refined.api.Refined[String,eu.timepit.refined.string.MatchesRegex[java.lang.String(\"[a-zA-Z0-9]{25,40}\")]]]: Predicate failed: \"changeme\".matches(\"[a-zA-Z0-9]{25,40}\").",
//     "Missing system property [http.port]"
//   )
// )
</span>
<span class="n">show</span> <span class="o">{</span>
  <span class="n">config</span><span class="o">(</span>
    <span class="n">envs</span><span class="o">(</span>
      <span class="s">"APP_ENV"</span> <span class="o">-&gt;</span> <span class="s">"Production"</span><span class="o">,</span>
      <span class="s">"API_KEY"</span> <span class="o">-&gt;</span> <span class="s">"X9aKACPtircCrrFKYhwPr7fXx8srow"</span>
    <span class="o">),</span>
    <span class="n">props</span><span class="o">()</span>
  <span class="o">).</span><span class="n">left</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">messages</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Left(Vector("Missing system property [http.port]"))
</span>
<span class="n">show</span> <span class="o">{</span>
  <span class="n">config</span><span class="o">(</span>
    <span class="n">envs</span><span class="o">(</span>
      <span class="s">"APP_ENV"</span> <span class="o">-&gt;</span> <span class="s">"Production"</span><span class="o">,</span>
      <span class="s">"API_KEY"</span> <span class="o">-&gt;</span> <span class="s">"X9aKACPtircCrrFKYhwPr7fXx8srow"</span>
    <span class="o">),</span>
    <span class="n">props</span><span class="o">(</span><span class="s">"http.port"</span> <span class="o">-&gt;</span> <span class="s">"900"</span><span class="o">)</span>
  <span class="o">).</span><span class="n">left</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">messages</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Left(
//   Vector(
//     "System property [http.port] with value [900] cannot be converted to type [eu.timepit.refined.api.Refined[Int,eu.timepit.refined.numeric.Interval.Closed[Int(1024),Int(65535)]]]: Left predicate of (!(900 &lt; 1024) &amp;&amp; !(900 &gt; 65535)) failed: Predicate (900 &lt; 1024) did not fail."
//   )
// )
</span>
<span class="n">show</span> <span class="o">{</span>
  <span class="n">config</span><span class="o">(</span>
    <span class="n">envs</span><span class="o">(</span>
      <span class="s">"APP_ENV"</span> <span class="o">-&gt;</span> <span class="s">"Production"</span><span class="o">,</span>
      <span class="s">"API_KEY"</span> <span class="o">-&gt;</span> <span class="s">"X9aKACPtircCrrFKYhwPr7fXx8srow"</span>
    <span class="o">),</span>
    <span class="n">props</span><span class="o">(</span><span class="s">"http.port"</span> <span class="o">-&gt;</span> <span class="s">"4000"</span><span class="o">)</span>
  <span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Right(Config(X9aKACPtircCrrFKYhwPr7fXx8srow, 10, 4000))
</span></code></pre></div></div>

<p>Finally, when running the application, simply provide the actual <code class="highlighter-rouge">ConfigSource</code>s for environment variables and system properties.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span> <span class="o">{</span> <span class="n">config</span><span class="o">(</span><span class="nc">ConfigSource</span><span class="o">.</span><span class="nc">Environment</span><span class="o">,</span> <span class="nc">ConfigSource</span><span class="o">.</span><span class="nc">Properties</span><span class="o">)</span> <span class="o">}</span>
<span class="c1">// Right(Config(RacrqvWjuu4KVmnTG9b6xyZMTP7jnX, 10, 4000))
</span></code></pre></div></div>

<h3 id="conclusion">Conclusion</h3>
<p>In this blog post, we’ve seen how we can make the configuration loading process, with configuration files, less error-prone, by eliminating the boilerplate code with <a href="https://github.com/pureconfig/pureconfig">PureConfig</a>, and encoding validation with <a href="https://github.com/fthomas/refined">refined</a> – seeing how the two libraries can work together seamlessly.</p>

<p>We’ve also identified cases where we can use Scala as a configuration language, seeing that it’s particularly suitable in cases where it’s easy to change and deploy software. We’ve introduced the challenge of loading configuration values from the environment and seen how <a href="https://cir.is">Ciris</a> can help you with that, letting you focus on the configuration. We’ve seen that Scala configurations can provide more compile-time safety and flexibility than traditional configurations with configuration files.</p>

<p>If you’re looking for more information on Ciris, the project’s website (<a href="https://cir.is">https://cir.is</a>) is a good start.<br />
There’s also a <a href="https://cir.is/docs/basics">usage guide</a> and <a href="https://cir.is/api">API documentation</a> which expands on what’s been discussed here.</p>


<h2>Licensing</h2>
<p>
  Unless otherwise noted, all content is licensed under a <a href="https://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.
</p>


  <div class="post__author js-fade-in">
    
    
      
        <img class="portrait" src="/img/media/speakers/viktorloevgren.png" />
      
      <p>by Viktor Lövgren
    
    on Jun 21, 2017</p>

    
  <a href="https://twitter.com/vlovgr" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @vlovgr</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


  <a class="github-button" href="https://github.com/vlovgr" aria-label="Follow @vlovgr on GitHub">Follow @vlovgr</a>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>


  </div>
  <a class="btn text" href="/blog">Back to blog</a>

  <br style="clear:both;">
<div class="disqus-container" style="padding-top:1em;">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'typelevel'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

</div>



    </div>

    <div class="footer">
      <div class="wrapper">
        <p>Copyright &copy; 2013-2018 the <a href="/">typelevel.org</a> <a href="/contributors.html">contributors</a>.</p>
        <ul class="navigation">
          <li><a href="/projects">Projects</a></li>
          <li><a href="/events">Events</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/about">About</a></li>
        </ul>
      </div>
    </div>
    
  <!-- Salvattore.js for the masonry layout -->
  <script type="text/javascript" src="/js/salvattore.min.js"></script>
  <!-- Salvattore.js for the masonry layout -->
  </body>
</html>
