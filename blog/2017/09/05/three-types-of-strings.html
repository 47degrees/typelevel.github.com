<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Typelevel.scala | There are at least three types of strings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Let the Scala compiler work for you. We provide type classes, instances, conversions, testing, supplements to the standard library, and much more.">


    <link rel="mask-icon" href="/img/favicon-safari.svg" color="#F51C2B">
    <link href="/img/favicon.png" rel="icon" type="image/x-icon">
    <link rel="alternate" href="/blog/feed.rss" title="RSS feed" type="application/rss+xml">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,400italic,700' rel='stylesheet' type='text/css'>

    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/app.js"></script>
  </head>
  <body class="no-js ">
    <div class="header">
      <div class="wrapper">
        <a href="/">
          <div class="header__logo">
            Typelevel.scala
          </div>
        </a>
        <a href="#" class="header__menu">
          Menu
        </a>
        <ul class="navigation" role="navigation">
          <li >
            <a href="/projects/">Projects</a>
          </li>
          <li >
            <a href="/events/">Events</a>
          </li>
          <li  class="active" >
            <a href="/blog/">Blog</a>
          </li>
          <li >
            <a href="/about.html">About</a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="wrapper">
      <div class="content post js-fade-in">
  <h2>There are at least three types of strings</h2>

  <p><a href="https://contributors.scala-lang.org/t/pre-sip-unboxed-wrapper-types/987">Newtype mechanisms</a>
are a great way to introduce wrapper-free, global distinctions of
“different” instances of the same type. But we can do that on a local
level, too,
<a href="https://gist.github.com/jbgi/d6b677d084fafc641fe01f7ffd00591c/70842ca600e53e8c237c681773fe4e16bd679628#file-label-java-L32">by using type parameters</a>.</p>

<p>Consider these two signatures.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">mungeIDs</span><span class="o">(</span><span class="n">uids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="n">gids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span>
             <span class="n">oids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Magic</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>

<span class="k">def</span> <span class="n">mungeIDsSafely</span><span class="o">[</span><span class="kt">UID</span> <span class="k">&lt;:</span> <span class="kt">String</span>, <span class="kt">GID</span> <span class="k">&lt;:</span> <span class="kt">String</span>, <span class="kt">OID</span> <span class="k">&lt;:</span> <span class="kt">String</span><span class="o">]</span>
            <span class="o">(</span><span class="n">uids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">UID</span><span class="o">],</span> <span class="n">gids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">GID</span><span class="o">],</span>
             <span class="n">oids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">OID</span><span class="o">])</span><span class="k">:</span> <span class="kt">Magic</span><span class="o">[</span><span class="kt">UID</span>, <span class="kt">GID</span>, <span class="kt">OID</span><span class="o">]</span> 
</code></pre></div></div>

<p>The second function is a strictly more general interface; the first,
concrete signature can be implemented by calling the second function,
passing <code class="highlighter-rouge">[String, String, String]</code> as the type arguments. There is no
need to even have the first signature; anywhere in your program where
you pass three <code class="highlighter-rouge">List[String]</code>s as arguments to <code class="highlighter-rouge">mungeIDsSafely</code>, the
proper type arguments will be inferred.</p>

<p>Yet, assuming you don’t wish <code class="highlighter-rouge">mungeIDs</code> to be oracular (i.e. a source
of UIDs, GIDs, and OIDs), the second signature is probably much more
reliable, because type parameters are quite as
<a href="/blog/2017/02/13/more-types-than-classes.html#it-must-not-necessarily-be-anything">mysterious</a>
as the opaque abstract type members of the newtype mechanism.</p>

<ol>
  <li><code class="highlighter-rouge">mungeIDsSafely</code> can’t invent new IDs, not even with <code class="highlighter-rouge">null</code>.</li>
  <li>It can’t combine them to produce new IDs.</li>
  <li>It <em>can</em> treat the three list arguments as <code class="highlighter-rouge">List[String]</code>. However,
it cannot convert any <code class="highlighter-rouge">String</code> back into an ID; any UIDs, GIDs, or
OIDs that appear in the result <code class="highlighter-rouge">Magic[UID, GID, OID]</code> must have
come from one of the argument lists, directly. (That’s not to say
that <code class="highlighter-rouge">mungeIDsSafely</code> can’t <em>use</em> the string-nature to make that
decision; for example, it could always choose the
smallest-as-string UID to put into the resulting <code class="highlighter-rouge">Magic</code>. But, that
UID is <em>still</em> enforced to be a proper element of the <code class="highlighter-rouge">uids</code>
argument, and cannot be gotten from anywhere else.</li>
  <li>Perhaps most importantly, it cannot mix up UIDs, GIDs, and
OIDs. Even though, “really”, they’re all strings!</li>
</ol>

<p>It is entirely irrelevant that you cannot subclass <code class="highlighter-rouge">String</code> in Scala,
Java, or whatever.
<a href="/blog/2017/02/13/more-types-than-classes.html">There are more types than classes</a>.</p>

<p>Given the advantages, it’s very unfortunate that the signature of
<code class="highlighter-rouge">mungeIDsSafely</code> is so much noisier than that of <code class="highlighter-rouge">mungeIDs</code>.  At least
you have the small consolation of eliminating more useless unit tests.</p>

<p>This is a good first approximation at moving away from the dangers of
concreteness in Scala, and has the advantage of working in Java, too
(sort of; the <code class="highlighter-rouge">null</code> prohibition is sadly relaxed).</p>

<h2 id="non-supertype-constraints">Non-supertype constraints</h2>

<p>In Scala, you can also use implicits to devise arbitrary constraints,
similar to typeclasses in Haskell, and sign your functions using
implicits instead, for much finer-grained control, improved safety,
and types-as-documentation.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// a typeclass for "IDish types" (imagine instances)
</span><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">IDish</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>

<span class="nc">def</span> <span class="n">mungeIDsTCey</span><span class="o">[</span><span class="kt">UID:</span> <span class="kt">IDish</span>, <span class="kt">GID:</span> <span class="kt">IDish</span>, <span class="kt">OID:</span> <span class="kt">IDish</span><span class="o">]</span>
            <span class="o">(</span><span class="n">uids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">UID</span><span class="o">],</span> <span class="n">gids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">GID</span><span class="o">],</span>
             <span class="n">oids</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">OID</span><span class="o">])</span><span class="k">:</span> <span class="kt">Magic</span><span class="o">[</span><span class="kt">UID</span>, <span class="kt">GID</span>, <span class="kt">OID</span><span class="o">]</span> 
</code></pre></div></div>

<p>Though all three types have the same constraint, <code class="highlighter-rouge">IDish</code>, they are
still distinct types.  And now, the coupling with <code class="highlighter-rouge">String</code> is broken;
as the program author, you get to decide whether you want that or not.</p>

<h2 id="pitfalls-avoided-for-you">Pitfalls avoided for you</h2>

<p>Luckily, Java doesn’t make the mistake of “reified generics”. If it
did, you could ask whether <code class="highlighter-rouge">UID = GID = OID = String</code>, and all your
safety guarantees would be gone. Forcing all generics to be reified
does not grant you any new expressive power; all it does is
permanently close off large swaths of the spectrum of mystery to you,
forbidding you from using the full scope of the design space to
improve the reliability of your well-typed programs.</p>

<p>The same goes for claiming that <code class="highlighter-rouge">null</code> ought to be a default member of
<em>every</em> type, even the abstract ones that ought to be a little more
mysterious; it’s easy to add new capabilities (e.g. Scala’s <code class="highlighter-rouge">&gt;: Null</code>
constraint, if you really <em>must</em> use <code class="highlighter-rouge">null</code>), but taking them away is
much, much harder.</p>

<p>Furthering this spirit of making good programs easier to write and bad
programs harder to write, a useful area of research in Scala might be
making signatures such as that of <code class="highlighter-rouge">mungeIDsSafely</code> nicer, or
signatures such as that of <code class="highlighter-rouge">mungeIDs</code> uglier.</p>


<h2>Licensing</h2>
<p>
  Unless otherwise noted, all content is licensed under a <a href="https://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.
</p>


  <div class="post__author js-fade-in">
    
    
      
      <p>by Stephen Compall
    
    on Sep 05, 2017</p>

    
  <a href="https://twitter.com/S11001001" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @S11001001</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


  <a class="github-button" href="https://github.com/S11001001" aria-label="Follow @S11001001 on GitHub">Follow @S11001001</a>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>


  </div>
  <a class="btn text" href="/blog">Back to blog</a>

  <br style="clear:both;">
<div class="disqus-container" style="padding-top:1em;">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'typelevel'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

</div>



    </div>

    <div class="footer">
      <div class="wrapper">
        <p>Copyright &copy; 2013-2018 the <a href="/">typelevel.org</a> <a href="/contributors.html">contributors</a>.</p>
        <ul class="navigation">
          <li><a href="/projects">Projects</a></li>
          <li><a href="/events">Events</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/about">About</a></li>
        </ul>
      </div>
    </div>
    
  <!-- Salvattore.js for the masonry layout -->
  <script type="text/javascript" src="/js/salvattore.min.js"></script>
  <!-- Salvattore.js for the masonry layout -->
  </body>
</html>
