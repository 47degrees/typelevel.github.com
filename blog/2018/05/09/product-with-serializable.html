<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Typelevel.scala | Product with Serializable</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Let the Scala compiler work for you. We provide type classes, instances, conversions, testing, supplements to the standard library, and much more.">


    <link rel="mask-icon" href="/img/favicon-safari.svg" color="#F51C2B">
    <link href="/img/favicon.png" rel="icon" type="image/x-icon">
    <link rel="alternate" href="/blog/feed.rss" title="RSS feed" type="application/rss+xml">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,400italic,700' rel='stylesheet' type='text/css'>

    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/app.js"></script>
  </head>
  <body class="no-js ">
    <div class="header">
      <div class="wrapper">
        <a href="/">
          <div class="header__logo">
            Typelevel.scala
          </div>
        </a>
        <a href="#" class="header__menu">
          Menu
        </a>
        <ul class="navigation" role="navigation">
          <li >
            <a href="/projects/">Projects</a>
          </li>
          <li >
            <a href="/events/">Events</a>
          </li>
          <li  class="active" >
            <a href="/blog/">Blog</a>
          </li>
          <li >
            <a href="/about.html">About</a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="wrapper">
      <div class="content post js-fade-in">
  <h2>Product with Serializable</h2>

  <p>A somewhat common Scala idiom is to make an <code class="highlighter-rouge">abstract</code> type extend <code class="highlighter-rouge">Product with Serializable</code>. There isn’t an obvious reason to do this, and people have asked me a number of times why I’ve done this. While I don’t think that <code class="highlighter-rouge">Product</code> or <code class="highlighter-rouge">Serializable</code> are particularly good abstractions, there’s a reason that I extend them.</p>

<p>Let’s say that I’m writing a simple enum-like <code class="highlighter-rouge">Status</code> type:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">EnumExample1</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Status</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">Pending</span> <span class="k">extends</span> <span class="nc">Status</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">InProgress</span> <span class="k">extends</span> <span class="nc">Status</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">Finished</span> <span class="k">extends</span> <span class="nc">Status</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now let’s create a <code class="highlighter-rouge">Set</code> of statuses that represent incomplete items:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">EnumExample1._</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">incomplete</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="nc">Pending</span><span class="o">,</span> <span class="nc">InProgress</span><span class="o">)</span>
<span class="c1">// incomplete: scala.collection.immutable.Set[Product with Serializable with EnumExample1.Status] = Set(Pending, InProgress)
</span></code></pre></div></div>

<p>Here, I didn’t give in explicit return type to <code class="highlighter-rouge">incomplete</code> and you may have noticed that the compiler inferred a somewhat bizarre one: <code class="highlighter-rouge">Set[Product with Serializable with Status]</code>. Why is that?</p>

<p>The compiler generally tries to infer the most specific type possible. Usually this makes sense. If you write <code class="highlighter-rouge">val x = 3</code> you probably don’t want it to infer <code class="highlighter-rouge">val x: Any = 3</code>. And in the example above, I didn’t want the return type for <code class="highlighter-rouge">incomplete</code> to be inferred as <code class="highlighter-rouge">Any</code> or even <code class="highlighter-rouge">Set[Any]</code>. However, the compiler was a bit <em>too</em> clever and realized that not only is every item in the set an instance of <code class="highlighter-rouge">Status</code>, they are also instances of <code class="highlighter-rouge">Product</code> and <code class="highlighter-rouge">Serializable</code> since every <code class="highlighter-rouge">case object</code> (and <code class="highlighter-rouge">case class</code>) automatically extends <code class="highlighter-rouge">Product</code> and <code class="highlighter-rouge">Serializable</code>. Therefore, when it calculates the least upper bound (LUB) of the types in the set, it comes up with <code class="highlighter-rouge">Product with Serializable with Status</code>.</p>

<p>While there’s nothing inherently wrong with the return type of <code class="highlighter-rouge">Product with Serializable with Status</code>, it is verbose, it wasn’t what I intended, and in certain situations it might cause inference issues. Luckily there’s a simple workaround to get the inferred type that I want:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">EnumExample2</span> <span class="o">{</span>
  <span class="c1">// note the `extends` addition here
</span>  <span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Status</span> <span class="k">extends</span> <span class="nc">Product</span> <span class="k">with</span> <span class="nc">Serializable</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">Pending</span> <span class="k">extends</span> <span class="nc">Status</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">InProgress</span> <span class="k">extends</span> <span class="nc">Status</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">Finished</span> <span class="k">extends</span> <span class="nc">Status</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">EnumExample2._</span>
</code></pre></div></div>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">incomplete</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="nc">Pending</span><span class="o">,</span> <span class="nc">InProgress</span><span class="o">)</span>
<span class="c1">// incomplete: scala.collection.immutable.Set[EnumExample2.Status] = Set(Pending, InProgress)
</span></code></pre></div></div>

<p>Now since <code class="highlighter-rouge">Status</code> itself already includes <code class="highlighter-rouge">Product</code> and <code class="highlighter-rouge">Serializable</code>, <code class="highlighter-rouge">Status</code> is the LUB type of <code class="highlighter-rouge">Pending</code>, <code class="highlighter-rouge">InProgress</code>, and <code class="highlighter-rouge">Finished</code>.</p>


<h2>Licensing</h2>
<p>
  Unless otherwise noted, all content is licensed under a <a href="https://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.
</p>


  <div class="post__author js-fade-in">
    
    
      
      <p>by Cody Allen
    
    on May 09, 2018</p>

    
  <a href="https://twitter.com/FouriersTrick" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @FouriersTrick</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


  <a class="github-button" href="https://github.com/ceedubs" aria-label="Follow @ceedubs on GitHub">Follow @ceedubs</a>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>


  </div>
  <a class="btn text" href="/blog">Back to blog</a>

  <br style="clear:both;">
<div class="disqus-container" style="padding-top:1em;">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'typelevel'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

</div>



    </div>

    <div class="footer">
      <div class="wrapper">
        <p>Copyright &copy; 2013-2018 the <a href="/">typelevel.org</a> <a href="/contributors.html">contributors</a>.</p>
        <ul class="navigation">
          <li><a href="/projects">Projects</a></li>
          <li><a href="/events">Events</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/about">About</a></li>
        </ul>
      </div>
    </div>
    
  <!-- Salvattore.js for the masonry layout -->
  <script type="text/javascript" src="/js/salvattore.min.js"></script>
  <!-- Salvattore.js for the masonry layout -->
  </body>
</html>
