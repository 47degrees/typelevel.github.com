<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Typelevel.scala | Towards Scalaz (Part 2)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Let the Scala compiler work for you. We provide type classes, instances, conversions, testing, supplements to the standard library, and much more.">


    <link rel="mask-icon" href="/img/favicon-safari.svg" color="#F51C2B">
    <link href="/img/favicon.png" rel="icon" type="image/x-icon">
    <link rel="alternate" href="/blog/feed.rss" title="RSS feed" type="application/rss+xml">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,400italic,700' rel='stylesheet' type='text/css'>

    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/app.js"></script>
  </head>
  <body class="no-js ">
    <div class="header">
      <div class="wrapper">
        <a href="/">
          <div class="header__logo">
            Typelevel.scala
          </div>
        </a>
        <a href="#" class="header__menu">
          Menu
        </a>
        <ul class="navigation" role="navigation">
          <li >
            <a href="/projects/">Projects</a>
          </li>
          <li >
            <a href="/events/">Events</a>
          </li>
          <li  class="active" >
            <a href="/blog/">Blog</a>
          </li>
          <li >
            <a href="/about.html">About</a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="wrapper">
      <div class="content post js-fade-in">
  <h2>Towards Scalaz (Part 2)</h2>

  <p>A lot of people see Scalaz as a hard fringe, ivory tower,
not suited for real-world applications library, which is
unfortunate. The goal of this blog post series is to introduce
various components of Scalaz, and hopefully through this
allow folks to gain an understanding towards the power of
Scalaz.</p>

<p>As a prerequisite, I assume knowledge of type classes as they
are implemented and used in Scala, higher kinded types,
and sum types (e.g. <code class="highlighter-rouge">Option/Some/None</code>, <code class="highlighter-rouge">Either/Left/Right</code>).</p>

<p>For a tutorial/review on (higher) kinds, I recommend the following resources:</p>

<ul>
  <li><a href="http://blogs.atlassian.com/2013/09/scala-types-of-a-higher-kind/">Scala: Types of a higher kind</a></li>
  <li><a href="http://adriaanm.github.io/files/higher.pdf">Generics of a Higher Kind</a></li>
  <li><a href="http://stackoverflow.com/questions/6246719/what-is-a-higher-kinded-type-in-scala">SO: What is a higher kinded type in Scala?</a></li>
</ul>

<h2 id="part-2-summations-of-a-higher-kind">Part 2: Summations of a Higher Kind</h2>

<p><a href="/blog/2013/10/13/towards-scalaz-1.html">Last time</a> we left off after
writing our own generic <code class="highlighter-rouge">sum</code> function:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scalaz.Monoid</span>

<span class="k">def</span> <span class="n">sumGeneric</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">l</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">A</span><span class="k">:</span> <span class="kt">Monoid</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
  <span class="n">l</span><span class="o">.</span><span class="n">foldLeft</span><span class="o">(</span><span class="n">A</span><span class="o">.</span><span class="n">zero</span><span class="o">)((</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">A</span><span class="o">.</span><span class="n">append</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">))</span>
</code></pre></div></div>

<p>This allowed us to sum a list not only of numeric types like
<code class="highlighter-rouge">Int</code>, but also others that could be added and had a “zero” such as
<code class="highlighter-rouge">String</code> via string concatenation and the empty string, as well as
<code class="highlighter-rouge">List[A]</code> via list concatenation and the empty list.</p>

<p>But, we can do better! Why limit ourselves to <code class="highlighter-rouge">List</code>? What if we want
to sum over a <code class="highlighter-rouge">Vector</code>, or even a tree? We <em>could</em> use <code class="highlighter-rouge">Seq</code> and that
would allow us to pass in <code class="highlighter-rouge">List</code> or <code class="highlighter-rouge">Vector</code>, but it still brings up
the problem of trees, and any other data structure that may not fit
the <code class="highlighter-rouge">Seq</code> bill.</p>

<h3 id="what-do-we-want-folds">What do we want? Folds!</h3>
<p>Recall when we “came up with” <code class="highlighter-rouge">Semigroup</code> and <code class="highlighter-rouge">Monoid</code> last time -
what did we do? We simply looked at what operations we needed
(<code class="highlighter-rouge">add/append</code> and <code class="highlighter-rouge">zero</code>) and factored it out into a type class.
Let’s try doing the same this time.</p>

<p>So what are we doing with <code class="highlighter-rouge">List</code> in our implementation? Nothing much
really, we’re just folding over it. If we think about it, we could
“fold” over say, a tree as well. Let’s take this operation out into
a type class, and aptly name it <code class="highlighter-rouge">Foldable</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Foldable</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
  <span class="c1">// Instead of requiring the contents to be monoidal, let's
</span>  <span class="c1">// make it flexible by allowing a fold as long as we can convert
</span>  <span class="c1">// the contents to a type that has a `Monoid`.
</span>  <span class="k">def</span> <span class="n">foldMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">B</span><span class="k">:</span> <span class="kt">Monoid</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">B</span>
<span class="o">}</span>
</code></pre></div></div>

<p>And let’s implement instances of this type class for <code class="highlighter-rouge">List</code> and our own
<code class="highlighter-rouge">Tree</code>.</p>

<p>Our tree definition:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Tree</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
<span class="nc">case</span> <span class="k">class</span> <span class="nc">Node</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">left</span><span class="k">:</span> <span class="kt">Tree</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">right</span><span class="k">:</span> <span class="kt">Tree</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Tree</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Leaf</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">Tree</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</code></pre></div></div>

<p>and our instances:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">Foldable</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">listIsFoldable</span><span class="k">:</span> <span class="kt">Foldable</span><span class="o">[</span><span class="kt">List</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">Foldable</span><span class="o">[</span><span class="kt">List</span><span class="o">]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="n">foldMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">B</span><span class="k">:</span> <span class="kt">Monoid</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=</span>
        <span class="n">fa</span><span class="o">.</span><span class="n">foldLeft</span><span class="o">(</span><span class="n">B</span><span class="o">.</span><span class="n">zero</span><span class="o">)((</span><span class="n">acc</span><span class="o">,</span> <span class="n">elem</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="o">(</span><span class="n">acc</span><span class="o">,</span> <span class="n">f</span><span class="o">(</span><span class="n">elem</span><span class="o">)))</span>
    <span class="o">}</span>

  <span class="k">implicit</span> <span class="k">val</span> <span class="n">treeIsFoldable</span><span class="k">:</span> <span class="kt">Foldable</span><span class="o">[</span><span class="kt">Tree</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">Foldable</span><span class="o">[</span><span class="kt">Tree</span><span class="o">]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="n">foldMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Tree</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">B</span><span class="k">:</span> <span class="kt">Monoid</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=</span>
        <span class="n">fa</span> <span class="k">match</span> <span class="o">{</span>
          <span class="k">case</span> <span class="nc">Leaf</span><span class="o">()</span> <span class="k">=&gt;</span>
            <span class="n">B</span><span class="o">.</span><span class="n">zero</span>
          <span class="k">case</span> <span class="nc">Node</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="k">=&gt;</span>
            <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">),</span> <span class="n">B</span><span class="o">.</span><span class="n">append</span><span class="o">(</span><span class="n">foldMap</span><span class="o">(</span><span class="n">left</span><span class="o">)(</span><span class="n">f</span><span class="o">),</span> <span class="n">foldMap</span><span class="o">(</span><span class="n">right</span><span class="o">)(</span><span class="n">f</span><span class="o">)))</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>and finally, our new summing function:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">sumGeneric</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">F</span><span class="k">:</span> <span class="kt">Foldable</span><span class="o">[</span><span class="kt">F</span><span class="o">],</span> <span class="n">A</span><span class="k">:</span> <span class="kt">Monoid</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
  <span class="n">fa</span><span class="o">.</span><span class="n">foldMap</span><span class="o">(</span><span class="n">identity</span><span class="o">)</span>
</code></pre></div></div>

<h3 id="scalaz-to-the-rescue">Scalaz to the rescue</h3>
<p>As with last time, Scalaz defines the <code class="highlighter-rouge">Foldable</code> type class for us. However,
to really be “foldable”, not only should you define <code class="highlighter-rouge">foldMap</code>, but <code class="highlighter-rouge">foldRight</code>
as well. Some of you may be wondering why <code class="highlighter-rouge">foldRight</code> and not <code class="highlighter-rouge">foldLeft</code>, or both?
The reasons for this decision are that</p>

<ul>
  <li><code class="highlighter-rouge">foldLeft</code> can be defined in terms of <code class="highlighter-rouge">foldRight</code> (a fun exercise is to try this for yourself)</li>
  <li><code class="highlighter-rouge">foldLeft</code> fails on infinite lists (think <code class="highlighter-rouge">Stream</code> in Scala)</li>
</ul>

<p>That being said, Scalaz defines instances of <code class="highlighter-rouge">Foldable</code> for many of the standard
Scala types (<code class="highlighter-rouge">List</code>, <code class="highlighter-rouge">Vector</code>, <code class="highlighter-rouge">Stream</code>, <code class="highlighter-rouge">Option</code>), as well as its own (<code class="highlighter-rouge">Tree</code>, <code class="highlighter-rouge">EphemeralStream</code>).
The methods available on the type class not only include <code class="highlighter-rouge">foldMap</code> and <code class="highlighter-rouge">foldRight</code> which
are required to be implemented, but several derived ones as well including <code class="highlighter-rouge">fold</code> (<code class="highlighter-rouge">foldMap</code> with
<code class="highlighter-rouge">identity</code>), <code class="highlighter-rouge">foldLeft</code>, <code class="highlighter-rouge">toList/IndexedSeq/Stream</code>, among others.</p>

<p>So our code with <code class="highlighter-rouge">scalaz.Foldable</code> now looks like:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scalaz.</span><span class="o">{</span> <span class="nc">Foldable</span><span class="o">,</span> <span class="nc">Monoid</span> <span class="o">}</span>

<span class="c1">// Note that this is equivalent to scalaz.Foldable#fold
</span><span class="k">def</span> <span class="n">sumGeneric</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">F</span><span class="k">:</span> <span class="kt">Foldable</span><span class="o">[</span><span class="kt">F</span><span class="o">],</span> <span class="n">A</span><span class="k">:</span> <span class="kt">Monoid</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
  <span class="n">fa</span><span class="o">.</span><span class="n">fold</span>
</code></pre></div></div>

<p>Note that the implementation of the function is rather plain, but that’s a good thing!
This shows the level of genericity type classes, folds,  and Scalaz is capable of. If you ever
find yourself needing to fold something down, look at the methods available on
<code class="highlighter-rouge">scalaz.Foldable</code>. By simply adding an instance of <code class="highlighter-rouge">Foldable</code> to your <code class="highlighter-rouge">F[_]</code> by implementing
the two methods above, you get “for free” a bunch of
<a href="http://docs.typelevel.org/api/scalaz/stable/7.0.4/doc/#scalaz.Foldable">derived ones</a>!</p>

<h3 id="an-aside-taming-the-elephant">An Aside: Taming the Elephant</h3>
<p>In recent days, the word “Hadoop” has become synonymous with “big data.” The MapReduce
system made popular by <a href="http://research.google.com/archive/mapreduce.html">Google</a>
has made it’s way into several companies looking to glean information from their data.</p>

<p>Why am I mentioning this in a typelevel.scala blog post? Well, think about the reduce phase –
what is really happening? For a particular key, we’re given a list of values emitted
for that key, and we want to reduce those values into a single value. Sound familiar?
Sounds a bit like <code class="highlighter-rouge">fold</code>, doesn’t it? Note that not all reductions in MapReduce have to follow
monoid laws, but a surprising amount do as demonstrated by Twitter’s
<a href="https://github.com/twitter/algebird">Algebird</a> project.</p>

<p>Going back to <code class="highlighter-rouge">fold</code>, recall that in order to just <code class="highlighter-rouge">fold</code> we need to have something
<code class="highlighter-rouge">Foldable</code> that contains something that already has a <code class="highlighter-rouge">Monoid</code> instance. A more general
approach, as taken by <code class="highlighter-rouge">scalaz.Foldable</code>, is to also provide a <code class="highlighter-rouge">foldMap</code> function which
lets us also pass in a function <em>map</em>ping each element of the <code class="highlighter-rouge">Foldable</code> to something
that is a <code class="highlighter-rouge">Monoid</code>, and reduce over that instead.</p>

<p>So. Given something, say a <code class="highlighter-rouge">List[A]</code>, we want to <em>Map</em> each element of the list to
an element of a type that has a <code class="highlighter-rouge">Monoid</code> instance, and then we want to <em>Reduce</em> the
list down to a single value. What is this? All together now: MapReduce!</p>

<p>Unfortunately, Hadoop MapReduce by itself does not give you anything like a <code class="highlighter-rouge">List</code>.
Fortunately, our good friends at <a href="http://www.nicta.com.au/">NICTA</a> have developed
and open sourced the wonderful <a href="https://github.com/nicta/scoobi">Scoobi</a> project,
which abstracts over Hadoop MapReduce by providing a <code class="highlighter-rouge">List</code>-like interface, called a
<code class="highlighter-rouge">DList</code> (distributed list). Users treat the <code class="highlighter-rouge">DList</code> very similarly to how they would
a regular Scala <code class="highlighter-rouge">List</code>, and perform operations on it that get compiled down into
MapReduce jobs. Such operations include not only the familiar (and expected) <code class="highlighter-rouge">map</code>
and <code class="highlighter-rouge">reduce</code> combinators, but also our friends <code class="highlighter-rouge">foldMap</code> and <code class="highlighter-rouge">fold</code>. While <code class="highlighter-rouge">DList</code>’s
do not have a proper <code class="highlighter-rouge">Foldable</code> instance due to the difficulty of implementing <code class="highlighter-rouge">foldRight</code>
for the MapReduce, I find it to be a great example of the power of abstractions and
genericity abstract algebra and Scalaz provides to us as programmers.</p>

<h2 id="further-reading">Further Reading</h2>

<ul>
  <li><a href="http://tmorris.net/posts/list-folds-bfpg/index.html">List Folds at BFPG</a></li>
  <li><a href="http://www.cs.nott.ac.uk/~gmh/fold.pdf">A tutorial on the universality and expressiveness of folds</a></li>
</ul>

<h2 id="getting-help">Getting Help</h2>

<p>If you have any questions/comments/concerns, feel free to hop onto the IRC channel on
Freenode at <code class="highlighter-rouge">#scalaz</code>.</p>


<h2>Licensing</h2>
<p>
  Unless otherwise noted, all content is licensed under a <a href="https://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.
</p>


  <div class="post__author js-fade-in">
    
    
      
        <img class="portrait" src="/img/media/speakers/adelbertchang.jpeg" />
      
      <p>by Adelbert Chang
    
    on Dec 15, 2013</p>

    
  <a href="https://twitter.com/adelbertchang" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @adelbertchang</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


  <a class="github-button" href="https://github.com/adelbertc" aria-label="Follow @adelbertc on GitHub">Follow @adelbertc</a>
  <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>


  </div>
  <a class="btn text" href="/blog">Back to blog</a>

  <br style="clear:both;">
<div class="disqus-container" style="padding-top:1em;">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'typelevel'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

</div>



    </div>

    <div class="footer">
      <div class="wrapper">
        <p>Copyright &copy; 2013-2018 the <a href="/">typelevel.org</a> <a href="/contributors.html">contributors</a>.</p>
        <ul class="navigation">
          <li><a href="/projects">Projects</a></li>
          <li><a href="/events">Events</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/about">About</a></li>
        </ul>
      </div>
    </div>
    
  <!-- Salvattore.js for the masonry layout -->
  <script type="text/javascript" src="/js/salvattore.min.js"></script>
  <!-- Salvattore.js for the masonry layout -->
  </body>
</html>
